El objetivo de esta guía de usuario es proporcionar a los usuarios un ejemplo para la puesta a punto y ejecución de las 
funcionalidades implementadas en el paquete NPM \verb|ghshell| durante el Trabajo de Fin de Máster.

%---------------------------------------------------------------------------------
\section{Instalación}
\label{Apendice2:instalacion}

%---------------------------------------------------------------------------------
\subsection{Requisitos}
\label{subsec:b.1.1}

\begin{itemize}
	\item Node.js versión \textgreater = 8:
	
	Descargable desde la página oficial de Node.js (\url{https://nodejs.org/en/download/current/}).
	
\end{itemize}

%---------------------------------------------------------------------------------
\subsection{Dependencias}
\label{subsec:b.1.2}

Para poder generar los libros usando Gitbook, son necesarias las siguientes dependencias:

\begin{itemize}
	\item \underline{Paquete de Gitbook} (\url{https://www.npmjs.com/package/gitbook-cli}):
	
	Para instalarlo, basta con ejecutar el siguiente comando:
	
	\begin{verbatim}
		[~]$ npm install -g gitbook-cli
	\end{verbatim}

	\item \underline{Aplicación Calibre} (\url{https://calibre-ebook.com/download})
	
	Para instalarla, basta con ejecutar el siguiente comando:
	
	\begin{verbatim}
		[~]$ sudo aptitude install calibre
	\end{verbatim}
	
	{\bfseries NOTA}: en algunas distribuciones GNU/Linux, node es instalado como nodejs, por lo que es necesario crear un enlace simbólico:
	
	\begin{verbatim}
		[~]$ sudo ln -s /usr/bin/nodejs /usr/bin/node
	\end{verbatim}
	
\end{itemize}

%---------------------------------------------------------------------------------
\subsection{Instalación}
\label{subsec:b.1.3}

Para instalar el paquete \verb|ghshell|, basta con ejecutar el siguiente comando:

\begin{verbatim}
[~]$ npm install -g ghshell
\end{verbatim}

%---------------------------------------------------------------------------------


\section{Ejecución}
\label{Apendice2:ejecucion}

%---------------------------------------------------------------------------------
\subsection{Primeros pasos}
\label{subsec:b.2.1}

Para ejecutar el programa, basta con ejecutar el siguiente comando en la consola:

\begin{verbatim}
[~]$ ghshell
\end{verbatim}

%---------------------------------------------------------------------------------

\subsection{Iniciar/Cerrar sesión}
\label{subsec:b.2.1}
    
    Iniciar o cerrar sesión. Comandos \verb|login| y \verb|logout|. 
    
    	\begin{verbatim}
			ghshell > login
			ghshell > logout
		\end{verbatim}
    
    La primera vez que se ejecuta el programa, pedirá directamente el usuario y contraseña de GitHub:
    
    	\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.7\textwidth]{images/ghshell1}
		\caption{Login de usuario}
		\label{fig:ghshell1}
		\end{center}
		\end{figure}
		
 
 		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.6\textwidth]{images/ghshell2-1}
		\caption{Usuario autenticado}
		\label{fig:ghshell2-1}
		\end{center}
		\end{figure}
		
    Una vez que el usuario se autentifica con GitHub, se genera un token personal, que se usa posteriormente para acceder a la API de Github. Este token se almacena cifrado en el equipo del usuario, por lo que las siguientes ocasiones que utilice la herramienta no hará falta que vuelva a iniciar sesión:
        
        \begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/ghshell2-3}
		\caption{Token personal en GitHub}
		\label{fig:ghshell2-3}
		\end{center}
		\end{figure}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.6\textwidth]{images/ghshell2-4}
		\caption{Login automático una vez generado el token}
		\label{fig:ghshell2-4}
		\end{center}
		\end{figure}
		
	Si el usuario cierra sesión en la herramienta, se eliminará el token en GitHub y en el equipo:
	
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.6\textwidth]{images/ghshell2-2}
		\caption{Logout de usuario}
		\label{fig:ghshell2-2}
		\end{center}
		\end{figure}
		
\newpage
%---------------------------------------------------------------------------------

\subsection{Contexto principal}
\label{subsec:b.2.2}

	Una vez autentificados, en el menú principal podremos hacer las siguientes acciones:
	
	\begin{itemize}
		\item \underline{Mostrar la ayuda}. Comando \verb|help|.
		
		\begin{verbatim}
			ghshell > help
		\end{verbatim}
		
		En función del contexto donde nos encontremos, se mostrarán diferentes opciones en la ayuda.
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/help1-1}
		\caption{Ayuda global}
		\label{fig:help1-1}
		\end{center}
		\end{figure}
		
		%-------------------
		\item \underline{Mostrar el directorio de trabajo actual}. Comando \verb|pwd|.
		
		\begin{verbatim}
			ghshell > pwd
		\end{verbatim}
		
		Visualiza el directorio de trabajo donde se ha ejecutado el programa:
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.7\textwidth]{images/pwd}
		\caption{Directorio actual de trabajo}
		\label{fig:pwd}
		\end{center}
		\end{figure}
		
		{\bfseries NOTA}: este comando tiene el mismo comportamiento si nos encontramos dentro de una organización o dentro de un repositorio de una organización.
		\newpage
		
		%-------------------
		\item  \underline{Listar y acceder a organizaciones}. Comando \verb|orgs|.
		
		\begin{verbatim}
			ghshell > orgs [-l]
		\end{verbatim}
		
		Si se ejecuta el comando sin argumentos, pregunta al usuario a qué organización quiere acceder. Se puede usar la tecla tabulador para ver las organizaciones disponibles.
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.8\textwidth]{images/orgs1-1}
		\caption{Acceso a una organización}
		\label{fig:orgs1-1}
		\end{center}
		\end{figure}
		
		El {\it prompt} de la consola cambiará para indicarnos que nos encontramos dentro de la organización.
		\bigskip
		
		Si se ejecuta el comando con la opción \verb|-l|, simplemente lista las organizaciones a las que pertenece el usuario.
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.8\textwidth]{images/ghshell3}
		\caption{Lista de organizaciones del usuario}
		\label{fig:ghshell3}
		\end{center}
		\end{figure}

\newpage
		%-------------------
		\item  \underline{Listar y acceder a repositorios}. Comando \verb|repos|.
		
		\begin{verbatim}
			ghshell > repos [-l] [string | /regexp/]
		\end{verbatim}
		
		Si se ejecuta el comando sin argumentos, pregunta al usuario a qué repositorio quiere acceder. Se puede usar la tecla tabulador para ver los repositorios disponibles.
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.8\textwidth]{images/repos1-1}
		\caption{Acceso a un repositorio}
		\label{fig:repos1-1}
		\end{center}
		\end{figure}
		
		
		El {\it prompt} de la consola cambiará para indicarnos que nos encontramos dentro de un repositorio.		
		\bigskip
		
		Si se ejecuta el comando con la opción \verb|-l|, simplemente se listan los repositorios que pertenecen al usuario.
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/repos1-2}
		\caption{Listado de repositorios del usuario}
		\label{fig:repos1-2}
		\end{center}
		\end{figure}

\newpage
	
		Si se especifica como argumento un string o expresión regular, se mostrarán los repositorios que coincidan con ese argumento:
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.4\textwidth]{images/repos1-3}
		\caption{Listado de repositorios del usuario que coinciden con el argumento pasado}
		\label{fig:repos1-3}
		\end{center}
		\end{figure}
		
		
		{\bfseries NOTA}: este comando tiene el mismo comportamiento si nos encontramos dentro de una organización:
		
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.9\textwidth]{images/repos1-4}
		\caption{Acceso a un repositorio dentro de una organización}
		\label{fig:repos1-4}
		\end{center}
		\end{figure}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/repos1-5}
		\caption{Listado de repositorios de una organización}
		\label{fig:repos1-5}
		\end{center}
		\end{figure}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.7\textwidth]{images/repos1-6}
		\caption{Listado de repositorios de una organización que coinciden con el argumento pasado}
		\label{fig:repos1-6}
		\end{center}
		\end{figure}	
		
		%-------------------
		\item  \underline{Clonar repositorios}. Comando \verb|clone|.
		
		\begin{verbatim}
			ghshell > clone string | /regexp/
		\end{verbatim}	
		
		Al especificar el argumento como un string o expresión regular, se clonarán todos los repositorios que coincidan con ese argumento. 
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.9\textwidth]{images/clone1-1}
		\caption{Clonado de repositorios que coinciden con el string pasado}
		\label{fig:clone1-1}
		\end{center}
		\end{figure}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.9\textwidth]{images/clone1-2}
		\caption{Clonado de repositorios que coinciden con la regexp pasada}
		\label{fig:clone1-2}
		\end{center}
		\end{figure}
		
		
		El clonado se realiza de manera {\bfseries asíncrona}, por lo que podemos seguir trabajando mientras se clona(n) el/los repositorio(s). 
\bigskip
		
		Se puede observar el estado de la clonación revisando el fichero de log que se genera: \textless \verb|nombre-repositorio|\textgreater \verb|-clone.log|.:
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.7\textwidth]{images/clone1-3}
		\caption{Resultado del clonado de repositorios}
		\label{fig:clone1-3}
		\end{center}
		\end{figure}
		
\newpage		
		Los fichero de log muestran la información del clonado. Se ha añadido una huella de tiempo para tener un control más exacto sobre cuándo ocurre cada evento:
		
		\input{clone-log.tex}

\newpage		
		%-------------------		
		\item  \underline{Salir del programa}. Comando \verb|exit|.
		
		\bigskip
		Causa el cierre ordenado del programa.
		\bigskip
				
		{\bfseries NOTA}: este comando tiene el mismo comportamiento si nos encontramos dentro de una organización o dentro de un repositorio de una organización. 
		
	\end{itemize}

\subsection{Contexto de organización}
\label{subsec:b.2.2}

	Los comandos \verb|pwd|, \verb|repos|, \verb|clone| y \verb|exit| tienen el mismo comportamiento que en el contexto principal. 
\bigskip

	Además, en el caso del comando \verb|clone|, se creará una carpeta con el nombre de la organización en la que nos encontremos y en ella se guardarán todos los repositorios clonados.
	
	%-------------------
\begin{itemize}

	\item \underline{Mostrar la ayuda}. Comando \verb|help|.
		
		\begin{verbatim}
			ghshell > help
		\end{verbatim}
		
		En función del contexto donde nos encontremos, se mostrarán diferentes opciones en la ayuda.
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/help1-2}
		\caption{Ayuda en el contexto de organización}
		\label{fig:help1-2}
		\end{center}
		\end{figure}

\newpage	
	%-------------------	
	\item \underline{Salir del contexto actual}. Comando \verb|back|.
	
		\begin{verbatim}
			ghshell > back
		\end{verbatim}
		
		Si nos encontramos en un repositorio propio o en una organización, regresamos al contexto principal. 
		Si nos encontramos dentro de un repositorio de una organización, regresamos al contexto de la organización.
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.7\textwidth]{images/back1-1}
		\caption{Regreso al contexto principal desde una organización}
		\label{fig:back1-1}
		\end{center}
		\end{figure}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.8\textwidth]{images/back1-2}
		\caption{Regreso al contexto principal desde un repositorio}
		\label{fig:back1-2}
		\end{center}
		\end{figure}
		
	%-------------------	
	\item \underline{Ejecutar un script determinado}. Comando \verb|script|.
	
		\begin{verbatim}
			ghshell > script <file> /regexp/
		\end{verbatim}
		
	Este comando sirve para ejecutar un script. La ruta del fichero del script puede ser absoluta o relativa.
	
	Al especificar una expresión regular, se ejecutará el script en todos los repositorios que coincidan con la expresión regular indicada.
	
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.8\textwidth]{images/script1-1}
		\caption{Ejecución de script en repositorios que coinciden con la regexp pasada}
		\label{fig:script1-1}
		\end{center}
		\end{figure}
		
\newpage
	
	La ejecución de cada script se ejecuta en un proceso hijo independiente pero, a diferencia del clonado, el script se ejecuta línea a línea de manera {\bfseries síncrona}. 
\bigskip
	
	Se puede observar el estado de la ejecución del script y los resultados revisando el fichero de log que se genera:
	\bigskip
	\textless \verb|nombre-repositorio|\textgreater \verb|-|\textless \verb|nombre-script|\textgreater \verb|.log|
	
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.7\textwidth]{images/script1-2}
		\caption{Fichero de log generado resultante de la ejecución del script}
		\label{fig:script1-2}
		\end{center}
		\end{figure}
	
	%-------------------
	\item \underline{Exportar resultados}. Comando \verb|book|.
	
		\begin{verbatim}
			ghshell > book string | /regexp/
		\end{verbatim}
	
	Este comando genera un {\bfseries Gitbook} con los resultados de todos los scripts ejecutados sobre los repositorios. Este libro se genera en formato PDF y en HTML.
\bigskip
	
	Al especificar un string o expresión regular, se creará el libro por cada repositorios que coincida con la expresión regular indicada.
	
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.8\textwidth]{images/book1-1}
		\caption{Creación del Gitbook en repositorios que coinciden con la regexp pasada}
		\label{fig:book1-1}
		\end{center}
		\end{figure}
		
	
	La creación del libro se realiza de manera {\bfseries asíncrona}, por lo que se puede seguir trabajando mientras se genera. 
\bigskip
	
	Se puede observar el estado de la creación del libro y su exportación a PDF revisando los ficheros de logs que se generan:
\bigskip

	\textless \verb|nombre-repositorio|\textgreater \verb|-gitbook_build.out| y 
\bigskip
	
	\textless \verb|nombre-repositorio|\textgreater \verb|-gitbook_pdf.out|.
	\bigskip
	\bigskip
	
	Tanto el PDF como el HTML contará con las siguientes páginas:
		
		\begin{itemize}
			\item Índice (Tabla de contenidos).
			\item Introducción: en esta página se copiará el fichero {\it README.md} del repositorio. En caso de que no tuviera ese fichero, se imprimirá un mensaje que indica que el repositorio no tiene fichero README.md.
			\item Páginas correspondientes a la ejecución de cada script.
		\end{itemize}
		
		
    La carpeta que contiene el libro en HTML se llamará:
    \bigskip
     
	\textless \verb|nombre-repositorio|\textgreater \verb|_gitbook/_book|. 
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.7\textwidth]{images/ghshell8-4}
		\caption{Localización del HTML del Gitbook}
		\label{fig:ghshell8-4}
		\end{center}
		\end{figure}

\bigskip

	Para visualizar el libro en formato HTML, basta con ejecutar el comando:
	
	\begin{verbatim}
		[~]$ gitbook serve
	\end{verbatim}
	
	Se arrancará un servidor web y, accediendo a la página que nos indique la consola, se podrá leer el libro:
	
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.9\textwidth]{images/ghshell8-5}
		\caption{Visualizar libro en HTML (I)}
		\label{fig:ghshell8-5}
		\end{center}
		\end{figure}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.7\textwidth]{images/ghshell8-10}
		\caption{Visualizar libro en HTML (II)}
		\label{fig:ghshell8-10}
		\end{center}
		\end{figure}

\newpage		
		
	El fichero PDF generado se llamará \textless \verb|nombre-repositorio|\textgreater \verb|.pdf|. 
	
        \begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.9\textwidth]{images/ghshell8-6}
		\caption{Indice del PDF generado}
		\label{fig:ghshell8-6}
		\end{center}
		\end{figure}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.7\textwidth]{images/ghshell8-7}
		\caption{Introducción del PDF generado}
		\label{fig:ghshell8-7}
		\end{center}
		\end{figure}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.7\textwidth]{images/ghshell8-8}
		\caption{Resultado del clonado del repositorio}
		\label{fig:ghshell8-8}
		\end{center}
		\end{figure}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.7\textwidth]{images/ghshell8-9}
		\caption{Resultado de la ejecución del script en el repositorio}
		\label{fig:ghshell8-9}
		\end{center}
		\end{figure}   
	
	
	
\newpage
	
	%-------------------	 
	\item \underline{Seleccionar assignments}. Comando \verb|assignments|.
	
		\begin{verbatim}
			ghshell > assignments string | /regexp/ [clone|book|script <file>]
		\end{verbatim}
		
		Los assignments son tratados como un caso especial de repositorios dentro de una organización.
		
		Si sólo se pasa como argumento un string o una expresión regular, listará los assignments que coincidan con dicho argumento.
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.8\textwidth]{images/assignments1-1}
		\caption{Assignments que coinciden con la expresión regular}
		\label{fig:assignment1-1}
		\end{center}
		\end{figure}
		
		
		En el caso de que además se pase alguno de los parámetros: \verb|clone|, \verb|script <file>| o \verb|book|; se clonará, se ejecutará un script o se creará un libro respectivamente en los repositorios que coincidan con el string o la expresión regular. 
\bigskip

Además, en el caso del comando \verb|clone|, se creará una carpeta con el nombre de la asignación que contendrá todas las asignaciones clonadas.
	
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/ghshell6-1}
		\caption{Clonado de asignaciones que coinciden con la expresión regular}
		\label{fig:ghshell6-1}
		\end{center}
		\end{figure}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/assignments1-2}
		\caption{Ejecución de script en assignments que coinciden con la expresión regular}
		\label{fig:assignment1-2}
		\end{center}
		\end{figure}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/assignments1-3}
		\caption{Creación del Gitbook en los assignments que coinciden con la expresión regular}
		\label{fig:assignment1-3}
		\end{center}
		\end{figure}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.8\textwidth]{images/assignments1-4}
		\caption{Directorios y ficheros generados}
		\label{fig:assignment1-4}
		\end{center}
		\end{figure}		
	
\end{itemize}
\newpage

\subsection{Contexto de repositorio}
\label{subsec:b.2.3}

	Los comandos \verb|pwd| y \verb|exit| tienen el mismo comportamiento que en el contexto principal. 
\bigskip
	
	El comando \verb|back| tienen el mismo comportamiento que en el contexto de organizaciones.
	
\begin{itemize}

	\item \underline{Mostrar la ayuda}. Comando \verb|help|.
		
		\begin{verbatim}
			ghshell > help
		\end{verbatim}
		
		En función del contexto donde nos encontremos, se mostrarán diferentes opciones en la ayuda.
				
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/help1-3}
		\caption{Ayuda en el contexto de un repositorio}
		\label{fig:help1-2}
		\end{center}
		\end{figure}

	%-------------------	
	\item \underline{Clonar repositorios}. Comando \verb|clone|.
	
		\begin{verbatim}
			ghshell > clone
		\end{verbatim}
		
		En este contexto, se ejecuta sin argumentos y clona el repositorio donde nos encontremos.
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/clone1-4}
		\caption{Clonado de un repositorio dentro de una organización}
		\label{fig:clone1-4}
		\end{center}
		\end{figure}

\newpage
	
	%-------------------		
	\item \underline{Ejecutar un script determinado}. Comando \verb|script|.
	
		\begin{verbatim}
			ghshell > script <file>
		\end{verbatim}
		
		En este contexto, se ejecuta sin argumentos y ejecuta el script indicado sobre el repositorio donde nos encontremos.
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/script1-3}
		\caption{Ejecución de un script en un repositorio dentro de una organización}
		\label{fig:script1-3}
		\end{center}
		\end{figure}
		
	%-------------------
	\item \underline{Exportar resultados}. Comando \verb|book|.
	
		\begin{verbatim}
			ghshell > book
		\end{verbatim}
		
		En este contexto, se ejecuta sin argumentos y crea un Gitbook con los resultados de todos los scripts ejecutados sobre el repositorio donde nos encontremos.
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/book1-3}
		\caption{Creación del Gitbook en un repositorio dentro de una organización}
		\label{fig:book1-3}
		\end{center}
		\end{figure}
	
	%-------------------	
	\item \underline{Obtener el propietario del repositorio}. Comando \verb|owner|.
	
		\begin{verbatim}
			ghshell > owner
		\end{verbatim}
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=0.5\textwidth]{images/owner1-1}
		\caption{Propietario del repositorio}
		\label{fig:owner1-1}
		\end{center}
		\end{figure}
		
		Además, si nos encontramos en un repositorio que pertenece a una organización, muestra también los contribuyentes.
		
		\begin{figure}[H]
		\begin{center}
		\includegraphics[width=1\textwidth]{images/owner1-2}
		\caption{Contribuyentes del repositorio}
		\label{fig:owner1-2}
		\end{center}
		\end{figure}
	
\end{itemize}



